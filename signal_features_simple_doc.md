# SignalFeatures 参数详解

本文档详细介绍了 `AdaptiveDownsamplingSelector` 类中 `SignalFeatures` 的 19 个参数的公式、计算方法，并以数据序列
`[1, 2, 3, 10, 11]` 为例进行说明。

## 原始数据示例

- **数据序列 (y)**: `[1, 2, 3, 10, 11]`
- **索引序列 (x)**: `[0, 1, 2, 3, 4]`
- **样本数 (n)**: `5`

---

## 1. mean (均值)

- **公式**: $\bar{y} = \frac{1}{n} \sum_{i=1}^n y_i$
- **计算**: $(1 + 2 + 3 + 10 + 11) / 5 = 27 / 5 = 5.4$
- **示例值**: `5.4`

## 2. stdDev (标准差)

- **公式**: $\sigma = \sqrt{\frac{1}{n} \sum_{i=1}^n (y_i - \bar{y})^2}$
- **计算
  **: $\sqrt{((1-5.4)^2 + (2-5.4)^2 + (3-5.4)^2 + (10-5.4)^2 + (11-5.4)^2) / 5} = \sqrt{89.2 / 5} = \sqrt{17.84} \approx 4.2237$
- **示例值**: `4.2237`

## 3. range (极差)

- **公式**: $R = y_{max} - y_{min}$
- **计算**: $11 - 1 = 10$
- **示例值**: `10.0`

## 4. volatility (绝对路径波动率)

- **公式**: $V = \frac{\sum_{i=1}^{n-1} |y_{i+1} - y_i|}{R}$
- **计算**: $(|2-1| + |3-2| + |10-3| + |11-10|) / 10 = (1 + 1 + 7 + 1) / 10 = 1.0$
- **示例值**: `1.0`

## 5. normalizedVolatility (归一化波动率)

- **说明**: 对残差序列（去趋势后的数据）进行计算。
- **公式**: $\frac{1}{n-1} \sum_{i=1}^{n-1} \frac{|r_{i+1} - r_i|}{(|r_i| + |r_{i+1}|) / 2}$ (如果分母过小则设为 1)。
- **残差 (r)**: 基于线性拟合 $y = 2.8x - 0.2$，残差为 `[1.2, -0.6, -2.4, 1.8, 0]`。
- **计算**:
    - $lag_1: |(-0.6)-1.2| / 0.9 = 2.0$
    - $lag_2: |(-2.4)-(-0.6)| / 1.5 = 1.2$
    - $lag_3: |1.8-(-2.4)| / 2.1 = 2.0$
    - $lag_4: |0-1.8| / 0.9 = 2.0$
    - $Avg: (2.0 + 1.2 + 2.0 + 2.0) / 4 = 1.8$
- **示例值**: `1.8`

## 6. flatness (平坦度)

- **公式**: $F = \frac{\sigma}{R}$
- **计算**: $4.2237 / 10 = 0.42237$
- **示例值**: `0.42237`

## 7. linearity (线性度/R²)

- **公式**: $R^2 = 1 - \frac{SS_{res}}{SS_{tot}}$
- **计算**: $SS_{tot} = 89.2$, $SS_{res} = 10.8$。$R^2 = 1 - (10.8 / 89.2) \approx 0.8789$
- **示例值**: `0.8789`

## 8. periodicity (周期性强度)

- **说明**: 在特定延迟范围内最大的自相关系数。
- **注意**: 当 $n < 10$ 时，该值硬编码返回 `0.0`。
- **示例值**: `0.0`

## 9. autocorrelation (自相关系数)

- **公式**: $\rho(lag) = \frac{\sum_{i=1}^{n-lag} (y_i - \bar{y})(y_{i+lag} - \bar{y})}{\sum_{i=1}^n (y_i - \bar{y})^2}$
- **计算**: $lag = \max(1, n/4) = 1$。分子为 $37.84$，分母为 $89.2$。$37.84 / 89.2 \approx 0.4242$
- **示例值**: `0.4242`

## 10. stepCount (阶跃次数)

- **说明**: 一阶导数超出 $\bar{d} + 3\sigma_d$ 阈值的次数。
- **计算**: 导数序列 `[1, 1, 7, 1]`。阈值计算约等于 `10.29`。所有值均未超过阈值。
- **示例值**: `0`

## 11. trendSlope (趋势斜率)

- **公式**: 线性拟合 $y = ax + b$ 中的 $a$。
- **计算**: 使用最小二乘法计算得 $a = 2.8$。
- **示例值**: `2.8`

## 12. noiseRatio (噪声占比)

- **公式**: $\frac{\sum_{i=1}^{n-2} |y_{i+2} - 2y_{i+1} + y_i|}{\sum_{i=1}^{n-2} |y_{i+2} - y_i|}$
- **计算**:
    - 分子: $|3 - 2(2) + 1| + |10 - 2(3) + 2| + |11 - 2(10) + 3| = 0 + 6 + 6 = 12$
    - 分母: $|3 - 1| + |10 - 2| + |11 - 3| = 2 + 8 + 8 = 18$
    - 比值: $12 / 18 = 0.6667$
- **示例值**: `0.6667`

## 13. zeroCrossings (过零率)

- **公式**: 信号跨越均值 $\bar{y}$ 的次数。
- **计算**: 数据在 `3` (低于 5.4) 和 `10` (高于 5.4) 之间发生了一次跳转。
- **示例值**: `1`

## 14. maxAbsDerivative (最大瞬时变化率)

- **公式**: $\max |y_{i+1} - y_i|$
- **计算**: $\max(1, 1, 7, 1) = 7$
- **示例值**: `7.0`

## 15. estimatedPeriod (预估周期)

- **说明**: 自相关最高时对应的 lag 值。
- **注意**: 当 $n < 10$ 时返回 `0`。
- **示例值**: `0`

## 16. residualStdDev (残差标准差)

- **公式**: $\sigma_{residuals}$
- **计算**: $\sqrt{SS_{res} / n} = \sqrt{10.8 / 5} = \sqrt{2.16} \approx 1.4697$
- **示例值**: `1.4697`

## 17. detrendedRange (去趋势极差)

- **公式**: $\max(r) - \min(r)$
- **计算**: $1.8 - (-2.4) = 4.2$
- **示例值**: `4.2`

## 18. trendStrength (趋势强度)

- **公式**: $\min(1.0, \frac{|slope| \times n}{range + 1e-6})$
- **计算**: $\min(1.0, (2.8 \times 5) / 10) = \min(1.0, 1.4) = 1.0$
- **示例值**: `1.0`

## 19. envelopeGrowthRatio (包络增长比)

- **公式**: $\min(10.0, \frac{range}{detrendedRange + 1e-6})$
- **计算**: $\min(10.0, 10 / 4.2) \approx 2.381$
- **示例值**: `2.381`
