# AdaptiveDownsamplingSelector v5.0 技术总结文档

## 1. 版本概述

**AdaptiveDownsamplingSelector v5.0** 是针对大规模时序数据展示的深度优化版本。在 v4.0 的基础上，针对“**噪声/高波动数据分布不均
**”以及“**关键极值点容易丢失**”的问题，引入了全新的混合采样策略。

---

## 2. 核心改进：`UNIFORM_WITH_EXTREMES` 算法

这是 v5.0 最核心的新增功能，旨在解决传统 LTTB 或 Min-Max 算法在处理随机噪声信号时的局限性。

### 2.1 算法逻辑流程

1. **全局极值保护**：扫描全量数据，锁定全局最大值和全局最小值的索引，确保无论如何采样，这两个点绝对不会丢失。
2. **局部极值提取**：识别信号中的局部峰值（Peak）和谷值（Valley），按显著性（Prominence）排序，优先保留最显著的局部特征（占用约
   15% 的配额）。
3. **均匀分布填充**：计算剩余的配额，在时间轴上建立均匀分布的基准点。如果基准点位置已被极值点占用，则自动向两侧搜索最接近的空白区域。
4. **二次归一化**：将所有选定点汇总、排序并去重，确保点数严格符合目标值，且分布科学。

### 2.2 预期效果

* **波形包络完整**：信号的最高点和最低点被永久保留。
* **视觉分布均匀**：解决了散点图在特定区域密集、在其他区域稀疏的视觉瑕疵。

---

## 3. 信号处理策略调整

为了更好地适配不同类型的物理信号，v5.0 重新调整了算法路由逻辑：

| 信号类型 (SignalType)       | 原采样策略 (v4.0)    | **新采样策略 (v5.0)**                 | 优化理由                    |
|:------------------------|:----------------|:---------------------------------|:------------------------|
| **NOISE** (高波动/噪声)      | `MIN_MAX`       | **`UNIFORM_WITH_EXTREMES`**      | 解决 Min-Max 导致的点数分布不合理问题 |
| **TREND_NOISE** (趋势+噪声) | `ADAPTIVE_LTTB` | **`UNIFORM_WITH_EXTREMES`**      | 确保在保留趋势的同时，噪声特征点分布均匀    |
| **高压缩比场景** (压缩率 > 10)   | 根据线性度选择         | **优先选择 `UNIFORM_WITH_EXTREMES`** | 在极端稀疏情况下，优先保证视觉分布的合理性   |

---

## 4. `fillGaps` 填充逻辑优化

在结果归一化阶段，如果点数不足，v5.0 改进了 gap 填充机制：

* **由"顺序填充"改为"中点优先"**：不再从 gap 的起始位置开始补点，而是优先选择 gap 的中点，避免采样点产生局部聚集现象。
* **均匀采样补全**：对于大的 gap，会在 1/4、1/2、3/4 位置进行多点均匀采样。

---

## 5. 总结

AdaptiveDownsamplingSelector v5.0 通过 **`UNIFORM_WITH_EXTREMES`** 算法实现了对复杂时序数据“**看得均匀、看准极值**
”的双重目标。特别是在处理传感器噪声、金融波动或大规模监控数据时，能够提供比传统算法更优秀的视觉还原度。
